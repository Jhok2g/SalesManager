CREATE TABLE "CLIENTE"(
	dni_cuil_cuit INTEGER PRIMARY KEY,
	nombre TEXT NOT NULL,
	apellido TEXT NOT NULL,
	condIVA TEXT NOT NULL,
	calleDom TEXT NOT NULL,
	nroDom INTEGER NOT NULL,
	codPostal INTEGER NOT NULL,
	ciudad TEXT NOT NULL,
	nroContacto INTEGER,
	email TEXT UNIQUE,
	saldoDeuda REAL NOT NULL
);

CREATE TABLE "DOC_LEGAL"(
	idDoc INTEGER PRIMARY KEY AUTOINCREMENT,
	tipo TEXT,
	nroDoc INTEGER,
	montoTot REAL NOT NULL,
	anulado BOOL NOT NULL,
	emisionLocal INTEGER NOT NULL,
	emisionCliente INTEGER NOT NULL,
	emisionFecha TEXT NOT NULL,

	UNIQUE(tipo, nroDoc)
	FOREIGN KEY (emisionLocal)
		REFERENCES LOCAL (codPtoVta)
			ON UPDATE CASCADE
			ON DELETE RESTRICT;
	FOREIGN KEY (emisionCliente)
		REFERENCES CLIENTE (dni_cuil_cuit)
			ON UPDATE CASCADE
			ON DELETE RESTRICT;
);

CREATE TABLE "REMITO"(
	idDoc INTEGER PRIMARY KEY,
	numBultos INTEGER NOT NULL,

	FOREIGN KEY (idDoc)
		REFERENCES DOC_LEGAL (idDoc)
			ON UPDATE CASCADE
			ON DELETE CASCADE;
);

CREATE TABLE "FACTURA"(
	idDoc INTEGER PRIMARY KEY,
	tipo_ABCX TEXT NOT NULL,
	saldoPago REAL NOT NULL,
	condPago TEXT NOT NULL,
	cae TEXT DEFAULT "nn",
	
	FOREIGN KEY (idDoc)
		REFERENCES DOC_LEGAL (idDoc)
			ON UPDATE CASCADE
			ON DELETE CASCADE;	
);

CREATE TABLE "RECIBO"(
	idDoc INTEGER PRIMARY KEY,
	descripcion TEXT,

	FOREIGN KEY (idDoc)
		REFERENCES DOC_LEGAL (idDoc)
			ON UPDATE CASCADE
			ON DELETE CASCADE;
);

CREATE TABLE "NOTA_CRED_DEB"(
	idDoc INTEGER PRIMARY KEY,
	descripcion TEXT,
	docAplicado INTEGER NOT NULL,

	FOREIGN KEY (idDoc)
		REFERENCES DOC_LEGAL (idDoc)
			ON UPDATE CASCADE
			ON DELETE CASCADE,	
	FOREIGN KEY (docAplicado)
		REFERENCES DOC_LEGAL (idDoc)
			ON UPDATE CASCADE
			ON DELETE RESTRICT;
);

CREATE TABLE "PAGA_FACT"(
	idFactura INTEGER,
	idRecibo INTEGER,
	saldoPrev REAL NOT NULL,
	valorPaga REAL NOT NULL,


	PRIMARY KEY (idFactura, idRecibo)	
	FOREIGN KEY (idFactura)
		REFERENCES DOC_LEGAL (idDoc)
			ON UPDATE CASCADE
			ON DELETE RESTRICT,
	FOREIGN KEY (idRecibo)
		REFERENCES DOC_LEGAL (idDoc)
			ON UPDATE CASCADE
			ON DELETE RESTRICT;
);	

CREATE TABLE "PROVEEDOR"(
	idProv INTEGER PRIMARY KEY AUTOINCREMENT,
	cuit INTEGER UNIQUE,
	nombre TEXT NOT NULL,
	nroContacto INTEGER NOT NULL,
	calleDomContacto TEXT,
	nroDomContacto INTEGER
		
);

CREATE TABLE "PRODUCTO"(
	id_codBarras INTEGER PRIMARY KEY,
	nombre TEXT UNIQUE,
	marca TEXT NOT NULL,
	descripcion TEXT,
	stock INTEGER,
	precioCosto REAL NOT NULL,
	precioUnit REAL NOT NULL,
	descuento REAL
);

CREATE TABLE "PROVEE"(
	idProv INTEGER,
	idProd INTEGER,

	PRIMARY KEY (idProv,idProd),
	FOREIGN KEY (idProv)
		REFERENCES PROVEEDOR (idProv)
			ON UPDATE CASCADE
			ON DELETE CASCADE,
	FOREIGN KEY (idProd)
		REFERENCES PRODUCTO (id_codBarras)
			ON UPDATE CASCADE
			ON DELETE CASCADE;
);

CREATE TABLE "UNIDADES" (
	uMed TEXT PRIMARY KEY
);

CREATE TABLE "COMPRA_PROD"(
	idFact INTEGER,
	idProd INTEGER,
	cantidad INTEGER NOT NULL,
	uMed INTEGER,
	
	FOREIGN KEY (idFact)
		REFERENCES FACTURA (id)
			ON UPDATE CASCADE
			ON DELETE CASCADE,
	FOREIGN KEY (idProd)
		REFERENCES PRODUCTO (id_codBarras)
			ON UPDATE CASCADE
			ON DELETE RESTRICT,
	FOREIGN KEY (uMed)
		REFERENCES UNIDADES (uMed)
			ON UPDATE RESTRICT
			ON DELETE RESTRICT;

);

CREATE TABLE "EN_FUNCION_DE_PROD"(
	idNota INTEGER,
	idProd INTEGER,
	cant INTEGER NOT NULL,

	PRIMARY KEY (idNota, idProd),
	FOREIGN KEY (idNota)
		REFERENCES NOTA_CRED_DEB (idDoc)
			ON UPDATE CASCADE
			ON DELETE CASCADE,
	FOREIGN KEY (idProd)
		REFERENCES PRODUCTO (id_codBarras)
			ON UPDATE CASCADE
			ON DELETE RESTRICT;
);

CREATE TABLE "LOCAL"(
	codPtoVta INTEGER PRIMARY KEY,
	nombre TEXT UNIQUE NOT NULL,
	calleDom TEXT NOT NULL,
	nroDom INTEGER NOT NULL,
	codPostal INTEGER NOT NULL, 
	ciudad TEXT NOT NULL,
	prov_est TEXT NOT NULL,
	nroContacto INTEGER NOT NULL
);